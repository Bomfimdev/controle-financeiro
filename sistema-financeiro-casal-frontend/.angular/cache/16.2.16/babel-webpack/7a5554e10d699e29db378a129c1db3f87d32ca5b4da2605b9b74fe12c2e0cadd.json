{"ast":null,"code":"import { from, throwError, BehaviorSubject } from 'rxjs';\nimport { map, catchError, tap } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./supabase.service\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"@angular/material/snack-bar\";\nexport class AuthService {\n  constructor(supabaseService, router, snackBar) {\n    this.supabaseService = supabaseService;\n    this.router = router;\n    this.snackBar = snackBar;\n    this.autenticado = new BehaviorSubject(false);\n    this.verificarAutenticacao();\n  }\n  verificarAutenticacao() {\n    from(this.supabaseService.getSession()).subscribe({\n      next: response => {\n        this.autenticado.next(!!response.data.session);\n      },\n      error: () => {\n        this.autenticado.next(false);\n      }\n    });\n  }\n  /**\n   * Realiza o login do usuário\n   * @param credentials Dados de autenticação (email e senha)\n   * @returns Observable com o usuário logado\n   */\n  login(credentials) {\n    return from(this.supabaseService.signIn(credentials.email, credentials.senha)).pipe(map(response => {\n      if (response.error) {\n        throw new Error(response.error.message);\n      }\n      this.snackBar.open('Login realizado com sucesso!', 'Fechar', {\n        duration: 3000\n      });\n      this.autenticado.next(true);\n      return response.data;\n    }), catchError(error => {\n      this.snackBar.open(error.message || 'Erro ao fazer login', 'Fechar', {\n        duration: 3000\n      });\n      throw error;\n    }));\n  }\n  /**\n   * Registra um novo usuário\n   * @param dados Dados de registro (email, senha, nome, sobrenome)\n   * @returns Observable com o usuário registrado\n   */\n  registrar(userData) {\n    return from(this.supabaseService.signUp(userData.email, userData.senha)).pipe(map(response => {\n      if (response.error) {\n        throw new Error(response.error.message);\n      }\n      // Atualizar o perfil do usuário com nome e sobrenome\n      return this.updateUserProfile(userData.nome, userData.sobrenome);\n    }), catchError(error => {\n      this.snackBar.open(error.message || 'Erro ao criar conta', 'Fechar', {\n        duration: 3000\n      });\n      throw error;\n    }));\n  }\n  updateUserProfile(nome, sobrenome) {\n    return from(this.supabaseService.updateUserProfile({\n      nome,\n      sobrenome\n    })).pipe(map(response => {\n      if (response.error) {\n        throw new Error(response.error.message);\n      }\n      this.snackBar.open('Conta criada com sucesso!', 'Fechar', {\n        duration: 3000\n      });\n      this.autenticado.next(true);\n      return response.data;\n    }), catchError(error => {\n      this.snackBar.open(error.message || 'Erro ao atualizar perfil', 'Fechar', {\n        duration: 3000\n      });\n      throw error;\n    }));\n  }\n  /**\n   * Recupera a senha do usuário\n   * @param email Email do usuário\n   * @returns Observable com o status da operação\n   */\n  recuperarSenha(email) {\n    return from(this.supabaseService.resetPassword(email)).pipe(map(({\n      data,\n      error\n    }) => {\n      if (error) {\n        throw new Error(error.message);\n      }\n      return true;\n    }), tap(() => {\n      this.snackBar.open('Email enviado com instruções para recuperação de senha.', 'Fechar', {\n        duration: 5000\n      });\n    }), catchError(erro => {\n      console.error('Erro na recuperação de senha:', erro);\n      this.snackBar.open(`Erro ao enviar email: ${erro.message}`, 'Fechar', {\n        duration: 5000\n      });\n      return throwError(() => erro);\n    }));\n  }\n  /**\n   * Realiza o logout do usuário\n   * @returns Observable com o status da operação\n   */\n  logout() {\n    this.supabaseService.signOut().then(() => {\n      this.router.navigate(['/login']);\n      this.snackBar.open('Logout realizado com sucesso!', 'Fechar', {\n        duration: 3000\n      });\n      this.autenticado.next(false);\n    }).catch(error => {\n      this.snackBar.open(error.message || 'Erro ao fazer logout', 'Fechar', {\n        duration: 3000\n      });\n    });\n  }\n  /**\n   * Verifica se o usuário está autenticado\n   * @returns Observable com status booleano de autenticação\n   */\n  estaAutenticado() {\n    return this.autenticado.asObservable();\n  }\n  /**\n   * Obtém os dados do usuário atual\n   * @returns Observable com o usuário atual\n   */\n  getUsuarioAtual() {\n    return this.supabaseService.getCurrentUser();\n  }\n  static {\n    this.ɵfac = function AuthService_Factory(t) {\n      return new (t || AuthService)(i0.ɵɵinject(i1.SupabaseService), i0.ɵɵinject(i2.Router), i0.ɵɵinject(i3.MatSnackBar));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: AuthService,\n      factory: AuthService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["from","throwError","BehaviorSubject","map","catchError","tap","AuthService","constructor","supabaseService","router","snackBar","autenticado","verificarAutenticacao","getSession","subscribe","next","response","data","session","error","login","credentials","signIn","email","senha","pipe","Error","message","open","duration","registrar","userData","signUp","updateUserProfile","nome","sobrenome","recuperarSenha","resetPassword","erro","console","logout","signOut","then","navigate","catch","estaAutenticado","asObservable","getUsuarioAtual","getCurrentUser","i0","ɵɵinject","i1","SupabaseService","i2","Router","i3","MatSnackBar","factory","ɵfac","providedIn"],"sources":["C:\\Users\\Bomfim\\Documents\\GitHub\\Controle-financeiro-casal\\workspace\\sistema-financeiro-casal-frontend\\src\\app\\services\\auth.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { Observable, from, throwError, of, BehaviorSubject } from 'rxjs';\nimport { map, catchError, tap } from 'rxjs/operators';\nimport { SupabaseService } from './supabase.service';\nimport { DadosAutenticacao, DadosRegistro, Usuario } from '../models/usuario.model';\nimport { MatSnackBar } from '@angular/material/snack-bar';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthService {\n  private autenticado = new BehaviorSubject<boolean>(false);\n\n  constructor(\n    private supabaseService: SupabaseService,\n    private router: Router,\n    private snackBar: MatSnackBar\n  ) {\n    this.verificarAutenticacao();\n  }\n\n  private verificarAutenticacao() {\n    from(this.supabaseService.getSession()).subscribe({\n      next: (response) => {\n        this.autenticado.next(!!response.data.session);\n      },\n      error: () => {\n        this.autenticado.next(false);\n      }\n    });\n  }\n\n  /**\n   * Realiza o login do usuário\n   * @param credentials Dados de autenticação (email e senha)\n   * @returns Observable com o usuário logado\n   */\n  login(credentials: { email: string; senha: string }): Observable<any> {\n    return from(this.supabaseService.signIn(credentials.email, credentials.senha)).pipe(\n      map(response => {\n        if (response.error) {\n          throw new Error(response.error.message);\n        }\n        this.snackBar.open('Login realizado com sucesso!', 'Fechar', {\n          duration: 3000\n        });\n        this.autenticado.next(true);\n        return response.data;\n      }),\n      catchError(error => {\n        this.snackBar.open(error.message || 'Erro ao fazer login', 'Fechar', {\n          duration: 3000\n        });\n        throw error;\n      })\n    );\n  }\n\n  /**\n   * Registra um novo usuário\n   * @param dados Dados de registro (email, senha, nome, sobrenome)\n   * @returns Observable com o usuário registrado\n   */\n  registrar(userData: { nome: string; sobrenome: string; email: string; senha: string }): Observable<any> {\n    return from(this.supabaseService.signUp(userData.email, userData.senha)).pipe(\n      map(response => {\n        if (response.error) {\n          throw new Error(response.error.message);\n        }\n        // Atualizar o perfil do usuário com nome e sobrenome\n        return this.updateUserProfile(userData.nome, userData.sobrenome);\n      }),\n      catchError(error => {\n        this.snackBar.open(error.message || 'Erro ao criar conta', 'Fechar', {\n          duration: 3000\n        });\n        throw error;\n      })\n    );\n  }\n\n  private updateUserProfile(nome: string, sobrenome: string): Observable<any> {\n    return from(this.supabaseService.updateUserProfile({ nome, sobrenome })).pipe(\n      map(response => {\n        if (response.error) {\n          throw new Error(response.error.message);\n        }\n        this.snackBar.open('Conta criada com sucesso!', 'Fechar', {\n          duration: 3000\n        });\n        this.autenticado.next(true);\n        return response.data;\n      }),\n      catchError(error => {\n        this.snackBar.open(error.message || 'Erro ao atualizar perfil', 'Fechar', {\n          duration: 3000\n        });\n        throw error;\n      })\n    );\n  }\n\n  /**\n   * Recupera a senha do usuário\n   * @param email Email do usuário\n   * @returns Observable com o status da operação\n   */\n  recuperarSenha(email: string): Observable<boolean> {\n    return from(this.supabaseService.resetPassword(email)).pipe(\n      map(({ data, error }) => {\n        if (error) {\n          throw new Error(error.message);\n        }\n        return true;\n      }),\n      tap(() => {\n        this.snackBar.open('Email enviado com instruções para recuperação de senha.', 'Fechar', {\n          duration: 5000\n        });\n      }),\n      catchError(erro => {\n        console.error('Erro na recuperação de senha:', erro);\n        this.snackBar.open(`Erro ao enviar email: ${erro.message}`, 'Fechar', {\n          duration: 5000\n        });\n        return throwError(() => erro);\n      })\n    );\n  }\n\n  /**\n   * Realiza o logout do usuário\n   * @returns Observable com o status da operação\n   */\n  logout(): void {\n    this.supabaseService.signOut().then(() => {\n      this.router.navigate(['/login']);\n      this.snackBar.open('Logout realizado com sucesso!', 'Fechar', {\n        duration: 3000\n      });\n      this.autenticado.next(false);\n    }).catch(error => {\n      this.snackBar.open(error.message || 'Erro ao fazer logout', 'Fechar', {\n        duration: 3000\n      });\n    });\n  }\n\n  /**\n   * Verifica se o usuário está autenticado\n   * @returns Observable com status booleano de autenticação\n   */\n  estaAutenticado(): Observable<boolean> {\n    return this.autenticado.asObservable();\n  }\n\n  /**\n   * Obtém os dados do usuário atual\n   * @returns Observable com o usuário atual\n   */\n  getUsuarioAtual(): Observable<Usuario | null> {\n    return this.supabaseService.getCurrentUser() as Observable<Usuario | null>;\n  }\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
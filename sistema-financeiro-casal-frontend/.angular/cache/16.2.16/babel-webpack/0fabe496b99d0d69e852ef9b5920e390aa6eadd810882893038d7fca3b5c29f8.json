{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/Bomfim/Documents/GitHub/Controle-financeiro-casal/workspace/sistema-financeiro-casal-frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { from, throwError } from 'rxjs';\nimport { map, catchError, tap } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./supabase.service\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"@angular/material/snack-bar\";\nexport class AuthService {\n  constructor(supabaseService, router, snackBar) {\n    this.supabaseService = supabaseService;\n    this.router = router;\n    this.snackBar = snackBar;\n  }\n  /**\n   * Realiza o login do usuário\n   * @param dados Dados de autenticação (email e senha)\n   * @returns Observable com o usuário logado\n   */\n  login(dados) {\n    return from(this.supabaseService.signIn(dados.email, dados.password)).pipe(map(response => {\n      if (response.error) {\n        throw new Error(response.error.message);\n      }\n      return response.data.user;\n    }), tap(user => {\n      this.snackBar.open('Login realizado com sucesso!', 'Fechar', {\n        duration: 3000\n      });\n      this.router.navigate(['/dashboard']);\n    }), catchError(erro => {\n      console.error('Erro no login:', erro);\n      this.snackBar.open(`Erro no login: ${erro.message}`, 'Fechar', {\n        duration: 5000\n      });\n      return throwError(() => erro);\n    }));\n  }\n  /**\n   * Registra um novo usuário\n   * @param dados Dados de registro (email, senha, nome, sobrenome)\n   * @returns Observable com o usuário registrado\n   */\n  registrar(dados) {\n    return from(this.supabaseService.signUp(dados.email, dados.password)).pipe(map(response => {\n      if (response.error) {\n        throw new Error(response.error.message);\n      }\n      // Criar o perfil completo no banco de dados\n      if (response.data.user) {\n        this.criarPerfilUsuario(response.data.user.id, dados);\n      }\n      return response.data.user;\n    }), tap(user => {\n      this.snackBar.open('Usuário criado com sucesso! Verifique seu email para confirmar o cadastro.', 'Fechar', {\n        duration: 5000\n      });\n      this.router.navigate(['/login']);\n    }), catchError(erro => {\n      console.error('Erro no registro:', erro);\n      this.snackBar.open(`Erro no registro: ${erro.message}`, 'Fechar', {\n        duration: 5000\n      });\n      return throwError(() => erro);\n    }));\n  }\n  /**\n   * Cria o perfil completo do usuário na tabela usuarios\n   * @param userId ID do usuário\n   * @param dados Dados de registro com nome e sobrenome\n   */\n  criarPerfilUsuario(userId, dados) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      try {\n        const {\n          error\n        } = yield _this.supabaseService.getSupabase().from('usuarios').insert({\n          id: userId,\n          nome: dados.nome,\n          sobrenome: dados.sobrenome,\n          email: dados.email\n        });\n        if (error) {\n          console.error('Erro ao criar perfil:', error);\n        }\n      } catch (erro) {\n        console.error('Erro na chamada API:', erro);\n      }\n    })();\n  }\n  /**\n   * Recupera a senha do usuário\n   * @param email Email do usuário\n   * @returns Observable com o status da operação\n   */\n  recuperarSenha(email) {\n    return from(this.supabaseService.resetPassword(email)).pipe(map(({\n      data,\n      error\n    }) => {\n      if (error) {\n        throw new Error(error.message);\n      }\n      return true;\n    }), tap(() => {\n      this.snackBar.open('Email enviado com instruções para recuperação de senha.', 'Fechar', {\n        duration: 5000\n      });\n    }), catchError(erro => {\n      console.error('Erro na recuperação de senha:', erro);\n      this.snackBar.open(`Erro ao enviar email: ${erro.message}`, 'Fechar', {\n        duration: 5000\n      });\n      return throwError(() => erro);\n    }));\n  }\n  /**\n   * Realiza o logout do usuário\n   * @returns Observable com o status da operação\n   */\n  logout() {\n    return from(this.supabaseService.signOut()).pipe(map(({\n      error\n    }) => {\n      if (error) {\n        throw new Error(error.message);\n      }\n      return true;\n    }), tap(() => {\n      this.router.navigate(['/login']);\n    }), catchError(erro => {\n      console.error('Erro no logout:', erro);\n      this.snackBar.open(`Erro no logout: ${erro.message}`, 'Fechar', {\n        duration: 3000\n      });\n      return throwError(() => erro);\n    }));\n  }\n  /**\n   * Verifica se o usuário está autenticado\n   * @returns Observable com status booleano de autenticação\n   */\n  estaAutenticado() {\n    return this.supabaseService.getCurrentUser().pipe(map(user => !!user));\n  }\n  /**\n   * Obtém os dados do usuário atual\n   * @returns Observable com o usuário atual\n   */\n  getUsuarioAtual() {\n    return this.supabaseService.getCurrentUser();\n  }\n  static {\n    this.ɵfac = function AuthService_Factory(t) {\n      return new (t || AuthService)(i0.ɵɵinject(i1.SupabaseService), i0.ɵɵinject(i2.Router), i0.ɵɵinject(i3.MatSnackBar));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: AuthService,\n      factory: AuthService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["from","throwError","map","catchError","tap","AuthService","constructor","supabaseService","router","snackBar","login","dados","signIn","email","password","pipe","response","error","Error","message","data","user","open","duration","navigate","erro","console","registrar","signUp","criarPerfilUsuario","id","userId","_this","_asyncToGenerator","getSupabase","insert","nome","sobrenome","recuperarSenha","resetPassword","logout","signOut","estaAutenticado","getCurrentUser","getUsuarioAtual","i0","ɵɵinject","i1","SupabaseService","i2","Router","i3","MatSnackBar","factory","ɵfac","providedIn"],"sources":["C:\\Users\\Bomfim\\Documents\\GitHub\\Controle-financeiro-casal\\workspace\\sistema-financeiro-casal-frontend\\src\\app\\services\\auth.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { Observable, from, throwError, of } from 'rxjs';\nimport { map, catchError, tap } from 'rxjs/operators';\nimport { SupabaseService } from './supabase.service';\nimport { DadosAutenticacao, DadosRegistro, Usuario } from '../models/usuario.model';\nimport { MatSnackBar } from '@angular/material/snack-bar';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthService {\n  \n  constructor(\n    private supabaseService: SupabaseService,\n    private router: Router,\n    private snackBar: MatSnackBar\n  ) { }\n\n  /**\n   * Realiza o login do usuário\n   * @param dados Dados de autenticação (email e senha)\n   * @returns Observable com o usuário logado\n   */\n  login(dados: DadosAutenticacao): Observable<Usuario> {\n    return from(this.supabaseService.signIn(dados.email, dados.password)).pipe(\n      map(response => {\n        if (response.error) {\n          throw new Error(response.error.message);\n        }\n        return response.data.user as Usuario;\n      }),\n      tap(user => {\n        this.snackBar.open('Login realizado com sucesso!', 'Fechar', {\n          duration: 3000\n        });\n        this.router.navigate(['/dashboard']);\n      }),\n      catchError(erro => {\n        console.error('Erro no login:', erro);\n        this.snackBar.open(`Erro no login: ${erro.message}`, 'Fechar', {\n          duration: 5000\n        });\n        return throwError(() => erro);\n      })\n    );\n  }\n\n  /**\n   * Registra um novo usuário\n   * @param dados Dados de registro (email, senha, nome, sobrenome)\n   * @returns Observable com o usuário registrado\n   */\n  registrar(dados: DadosRegistro): Observable<Usuario> {\n    return from(this.supabaseService.signUp(dados.email, dados.password)).pipe(\n      map(response => {\n        if (response.error) {\n          throw new Error(response.error.message);\n        }\n        \n        // Criar o perfil completo no banco de dados\n        if (response.data.user) {\n          this.criarPerfilUsuario(response.data.user.id, dados);\n        }\n        \n        return response.data.user as Usuario;\n      }),\n      tap(user => {\n        this.snackBar.open('Usuário criado com sucesso! Verifique seu email para confirmar o cadastro.', 'Fechar', {\n          duration: 5000\n        });\n        this.router.navigate(['/login']);\n      }),\n      catchError(erro => {\n        console.error('Erro no registro:', erro);\n        this.snackBar.open(`Erro no registro: ${erro.message}`, 'Fechar', {\n          duration: 5000\n        });\n        return throwError(() => erro);\n      })\n    );\n  }\n\n  /**\n   * Cria o perfil completo do usuário na tabela usuarios\n   * @param userId ID do usuário\n   * @param dados Dados de registro com nome e sobrenome\n   */\n  private async criarPerfilUsuario(userId: string, dados: DadosRegistro) {\n    try {\n      const { error } = await this.supabaseService.getSupabase()\n        .from('usuarios')\n        .insert({\n          id: userId,\n          nome: dados.nome,\n          sobrenome: dados.sobrenome,\n          email: dados.email\n        });\n      \n      if (error) {\n        console.error('Erro ao criar perfil:', error);\n      }\n    } catch (erro) {\n      console.error('Erro na chamada API:', erro);\n    }\n  }\n\n  /**\n   * Recupera a senha do usuário\n   * @param email Email do usuário\n   * @returns Observable com o status da operação\n   */\n  recuperarSenha(email: string): Observable<boolean> {\n    return from(this.supabaseService.resetPassword(email)).pipe(\n      map(({ data, error }) => {\n        if (error) {\n          throw new Error(error.message);\n        }\n        return true;\n      }),\n      tap(() => {\n        this.snackBar.open('Email enviado com instruções para recuperação de senha.', 'Fechar', {\n          duration: 5000\n        });\n      }),\n      catchError(erro => {\n        console.error('Erro na recuperação de senha:', erro);\n        this.snackBar.open(`Erro ao enviar email: ${erro.message}`, 'Fechar', {\n          duration: 5000\n        });\n        return throwError(() => erro);\n      })\n    );\n  }\n\n  /**\n   * Realiza o logout do usuário\n   * @returns Observable com o status da operação\n   */\n  logout(): Observable<boolean> {\n    return from(this.supabaseService.signOut()).pipe(\n      map(({ error }) => {\n        if (error) {\n          throw new Error(error.message);\n        }\n        return true;\n      }),\n      tap(() => {\n        this.router.navigate(['/login']);\n      }),\n      catchError(erro => {\n        console.error('Erro no logout:', erro);\n        this.snackBar.open(`Erro no logout: ${erro.message}`, 'Fechar', {\n          duration: 3000\n        });\n        return throwError(() => erro);\n      })\n    );\n  }\n\n  /**\n   * Verifica se o usuário está autenticado\n   * @returns Observable com status booleano de autenticação\n   */\n  estaAutenticado(): Observable<boolean> {\n    return this.supabaseService.getCurrentUser().pipe(\n      map(user => !!user)\n    );\n  }\n\n  /**\n   * Obtém os dados do usuário atual\n   * @returns Observable com o usuário atual\n   */\n  getUsuarioAtual(): Observable<Usuario | null> {\n    return this.supabaseService.getCurrentUser() as Observable<Usuario | null>;\n  }\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}